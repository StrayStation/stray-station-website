<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0a0a0a">
  <title>Release - StrayStation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --stray-cyan: #00d4ff;
      --stray-blue: #0099ff;
      --stray-dark-blue: #003d66;
      --stray-orange: #ff6b35;
      --bg-deep: #0a0a0a;
      --bg-surface: #1a1a1a;
      --text-primary: #f5f5f5;
      --text-secondary: rgba(245, 245, 245, 0.6);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      overflow: hidden;
      font-family: 'Space Mono', monospace;
      background: var(--bg-deep);
      color: var(--text-primary);
      height: 100vh;
      width: 100vw;
    }

    #app {
      width: 100%;
      height: 100%;
      position: relative;
    }

    /* ═══════════════════════════════════════════════════════════════
       WAREHOUSE SCENE
       ═══════════════════════════════════════════════════════════════ */
    
    .scene-container {
      position: absolute;
      inset: 0;
      background-image: url('warehouse_image.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* Atmospheric overlay */
    .scene-overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(
        ellipse at 50% 30%,
        transparent 0%,
        rgba(0, 0, 0, 0.2) 50%,
        rgba(0, 0, 0, 0.6) 100%
      );
      pointer-events: none;
    }

    /* ═══════════════════════════════════════════════════════════════
       LANDING SCREEN
       ═══════════════════════════════════════════════════════════════ */
    
    #landing-screen {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, rgba(0, 61, 102, 0.95) 0%, rgba(10, 10, 10, 0.98) 100%);
      z-index: 1000;
      padding: 2rem;
    }

    .landing-logo {
      width: clamp(200px, 40vw, 400px);
      height: auto;
      margin-bottom: 3rem;
      filter: drop-shadow(0 8px 24px rgba(0, 212, 255, 0.3));
      animation: float 6s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    .landing-title {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(2.5rem, 8vw, 5rem);
      font-weight: 900;
      color: var(--stray-cyan);
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
    }

    .landing-subtitle {
      font-family: 'Space Mono', monospace;
      font-size: clamp(1rem, 2.5vw, 1.5rem);
      color: var(--text-secondary);
      margin-bottom: 3rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }

    .landing-description {
      max-width: 600px;
      text-align: center;
      font-size: clamp(0.9rem, 2vw, 1.1rem);
      line-height: 1.8;
      color: var(--text-secondary);
      margin-bottom: 3rem;
    }

    .enter-btn {
      padding: 1.5rem 4rem;
      background: linear-gradient(135deg, var(--stray-cyan) 0%, var(--stray-blue) 100%);
      border: none;
      color: var(--bg-deep);
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      box-shadow: 0 8px 32px rgba(0, 212, 255, 0.4);
      position: relative;
      overflow: hidden;
    }

    .enter-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .enter-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 48px rgba(0, 212, 255, 0.6);
    }

    .enter-btn:hover::before {
      width: 300px;
      height: 300px;
    }

    @media (max-width: 768px) {
      .enter-btn {
        padding: 1rem 2.5rem;
        font-size: 1rem;
      }
    }

    /* ═══════════════════════════════════════════════════════════════
       UI OVERLAY
       ═══════════════════════════════════════════════════════════════ */
    
    .ui-top {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0.8) 0%, transparent 100%);
    }

    .stray-logo {
      width: 120px;
      height: auto;
      filter: drop-shadow(0 4px 12px rgba(0, 212, 255, 0.3));
    }

    .throw-counter {
      padding: 0.8rem 1.5rem;
      background: rgba(0, 61, 102, 0.8);
      border: 2px solid var(--stray-cyan);
      border-radius: 4px;
      color: var(--stray-cyan);
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
    }

    @media (max-width: 768px) {
      .ui-top {
        padding: 1rem;
      }
      .stray-logo {
        width: 80px;
      }
      .throw-counter {
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
      }
    }

    /* ═══════════════════════════════════════════════════════════════
       OBJECTS
       ═══════════════════════════════════════════════════════════════ */
    
    .items-container {
      position: absolute;
      bottom: 8%;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: clamp(1.5rem, 4vw, 3rem);
      padding: 0 2rem;
      z-index: 50;
    }

    .object-item {
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.6));
      position: relative;
    }

    .object-item:hover {
      transform: translateY(-10px) scale(1.05);
      filter: drop-shadow(0 12px 32px rgba(0, 212, 255, 0.4));
    }

    .object-item.selected {
      animation: pulse 1s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.6)); }
      50% { transform: scale(1.1); filter: drop-shadow(0 12px 32px rgba(0, 212, 255, 0.6)); }
    }

    /* Object SVGs */
    .object-plate {
      width: clamp(80px, 12vw, 120px);
      height: auto;
    }

    .object-bowl {
      width: clamp(85px, 13vw, 130px);
      height: auto;
    }

    .object-mug {
      width: clamp(75px, 11vw, 110px);
      height: auto;
    }

    .object-vase {
      width: clamp(70px, 10vw, 100px);
      height: auto;
    }

    .object-bottle {
      width: clamp(65px, 9vw, 90px);
      height: auto;
    }

    @media (max-width: 768px) {
      .items-container {
        gap: 1rem;
        padding: 0 1rem;
        bottom: 12%;
      }
    }

    /* ═══════════════════════════════════════════════════════════════
       WRITING INTERFACE
       ═══════════════════════════════════════════════════════════════ */
    
    .writing-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 3rem 2rem;
      background: linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.95) 40%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
      z-index: 75;
    }

    .writing-prompt {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(1rem, 2.5vw, 1.5rem);
      color: var(--stray-cyan);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      text-align: center;
    }

    .message-input {
      width: 100%;
      max-width: 600px;
      padding: 1.5rem;
      background: rgba(0, 61, 102, 0.3);
      border: 2px solid var(--stray-blue);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: 'Space Mono', monospace;
      font-size: 1.1rem;
      text-align: center;
      letter-spacing: 0.05em;
      backdrop-filter: blur(10px);
      transition: all 0.3s;
    }

    .message-input::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }

    .message-input:focus {
      outline: none;
      border-color: var(--stray-cyan);
      background: rgba(0, 61, 102, 0.5);
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.4);
    }

    .throw-button {
      padding: 1.5rem 3.5rem;
      background: linear-gradient(135deg, var(--stray-orange) 0%, #ff4500 100%);
      border: none;
      color: #fff;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      font-weight: 900;
      letter-spacing: 0.2em;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      box-shadow: 0 8px 32px rgba(255, 107, 53, 0.4);
      position: relative;
      overflow: hidden;
    }

    .throw-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .throw-button:hover:not(:disabled) {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 12px 48px rgba(255, 107, 53, 0.6);
    }

    .throw-button:hover:not(:disabled)::before {
      width: 400px;
      height: 400px;
    }

    .throw-button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }

    @media (max-width: 768px) {
      .writing-container {
        padding: 2rem 1rem;
      }
      .message-input {
        padding: 1rem;
        font-size: 0.95rem;
      }
      .throw-button {
        padding: 1rem 2rem;
        font-size: 1.1rem;
      }
    }

    /* ═══════════════════════════════════════════════════════════════
       PARTICLE EFFECTS
       ═══════════════════════════════════════════════════════════════ */
    
    .particle-pro {
      position: fixed;
      border-radius: 2px;
      pointer-events: none;
      z-index: 500;
      animation: particle-fly 2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    }

    @keyframes particle-fly {
      0% {
        transform: translate(0, 0) rotate(0deg) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(var(--vx), var(--vy)) rotate(var(--rotation)) scale(0.3);
        opacity: 0;
      }
    }

    .debris-piece {
      position: fixed;
      border-radius: 1px;
      pointer-events: none;
      z-index: 450;
    }

    .impact-mark {
      position: fixed;
      border-radius: 50%;
      pointer-events: none;
      z-index: 400;
      animation: impact-fade 0.5s ease-out;
    }

    @keyframes impact-fade {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    .dust-particle {
      position: fixed;
      border-radius: 50%;
      pointer-events: none;
      z-index: 425;
      animation: dust-rise 2s ease-out forwards;
    }

    @keyframes dust-rise {
      0% {
        transform: translateY(0) scale(1);
        opacity: 0.6;
      }
      100% {
        transform: translateY(-150px) scale(1.5);
        opacity: 0;
      }
    }

    /* ═══════════════════════════════════════════════════════════════
       UTILITIES
       ═══════════════════════════════════════════════════════════════ */
    
    .hidden {
      display: none !important;
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-out {
      animation: fadeOut 0.6s ease-out forwards;
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- LANDING SCREEN -->
    <div id="landing-screen">
      <img src="straystation_final.png" alt="StrayStation" class="landing-logo">
      <h1 class="landing-title">Release</h1>
      <p class="landing-subtitle">Cathartic Destruction</p>
      <p class="landing-description">
        Write down what's weighing on you. Choose your vessel. 
        Watch it shatter. Let it go.
      </p>
      <button class="enter-btn" onclick="enterApp()">
        <span>Enter</span>
      </button>
    </div>

    <!-- MAIN APP -->
    <div id="main-app" class="hidden">
      <!-- Background -->
      <div class="scene-container">
        <div class="scene-overlay"></div>
      </div>

      <!-- Top UI -->
      <div class="ui-top">
        <img src="straystation_final.png" alt="StrayStation" class="stray-logo">
        <div class="throw-counter">Throws: <span id="throw-count">0</span></div>
      </div>

      <!-- Objects -->
      <div id="items-view" class="items-container">
        <svg class="object-item object-plate" data-type="plate" data-material="ceramic" viewBox="0 0 200 60">
          <defs>
            <linearGradient id="plateGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#f0f0f0;stop-opacity:1" />
              <stop offset="50%" style="stop-color:#e8e8e8;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#d0d0d0;stop-opacity:1" />
            </linearGradient>
            <radialGradient id="plateShine">
              <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.6" />
              <stop offset="100%" style="stop-color:#ffffff;stop-opacity:0" />
            </radialGradient>
          </defs>
          <ellipse cx="100" cy="30" rx="95" ry="25" fill="url(#plateGrad)" stroke="#b0b0b0" stroke-width="2"/>
          <ellipse cx="100" cy="30" rx="95" ry="25" fill="url(#plateShine)" opacity="0.4"/>
          <ellipse cx="100" cy="28" rx="70" ry="18" fill="none" stroke="#c0c0c0" stroke-width="1" opacity="0.5"/>
        </svg>

        <svg class="object-item object-bowl" data-type="bowl" data-material="ceramic" viewBox="0 0 200 120">
          <defs>
            <linearGradient id="bowlGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#e8d4c0;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#c0a890;stop-opacity:1" />
            </linearGradient>
          </defs>
          <path d="M 30 40 Q 30 100, 100 110 Q 170 100, 170 40 Q 170 30, 160 30 L 40 30 Q 30 30, 30 40 Z" 
                fill="url(#bowlGrad)" stroke="#a08060" stroke-width="2"/>
          <ellipse cx="100" cy="35" rx="60" ry="12" fill="#f0e0d0" opacity="0.6"/>
        </svg>

        <svg class="object-item object-mug" data-type="mug" data-material="ceramic" viewBox="0 0 200 160">
          <defs>
            <linearGradient id="mugGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#6ba3c8;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#4a7a98;stop-opacity:1" />
            </linearGradient>
          </defs>
          <rect x="50" y="40" width="90" height="100" rx="10" fill="url(#mugGrad)" stroke="#3a5a78" stroke-width="2"/>
          <ellipse cx="95" cy="40" rx="45" ry="12" fill="#8bc0e0" opacity="0.7"/>
          <path d="M 140 70 Q 165 70, 170 90 Q 165 110, 140 110" fill="none" stroke="#3a5a78" stroke-width="8"/>
          <path d="M 140 70 Q 165 70, 170 90 Q 165 110, 140 110" fill="none" stroke="url(#mugGrad)" stroke-width="6"/>
        </svg>

        <svg class="object-item object-vase" data-type="vase" data-material="ceramic" viewBox="0 0 150 220">
          <defs>
            <linearGradient id="vaseGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#d8b896;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#a88860;stop-opacity:1" />
            </linearGradient>
          </defs>
          <path d="M 60 20 L 65 50 Q 65 120, 45 190 L 45 200 L 105 200 L 105 190 Q 85 120, 85 50 L 90 20 Z" 
                fill="url(#vaseGrad)" stroke="#886040" stroke-width="2"/>
          <ellipse cx="75" cy="20" rx="15" ry="8" fill="#e8c8a6"/>
          <ellipse cx="75" cy="200" rx="30" ry="10" fill="#886040"/>
        </svg>

        <svg class="object-item object-bottle" data-type="bottle" data-material="glass" viewBox="0 0 120 240">
          <defs>
            <linearGradient id="bottleGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#a8e0d0;stop-opacity:0.8" />
              <stop offset="100%" style="stop-color:#70b8a0;stop-opacity:0.9" />
            </linearGradient>
          </defs>
          <rect x="40" y="20" width="40" height="40" rx="4" fill="url(#bottleGrad)" stroke="#508870" stroke-width="2"/>
          <ellipse cx="60" cy="20" rx="20" ry="6" fill="#c0f0e0" opacity="0.6"/>
          <path d="M 35 60 L 30 180 Q 30 210, 60 220 Q 90 210, 90 180 L 85 60 Z" 
                fill="url(#bottleGrad)" stroke="#508870" stroke-width="2"/>
          <ellipse cx="60" cy="220" rx="30" ry="10" fill="#508870" opacity="0.6"/>
          <rect x="45" y="80" width="30" height="80" fill="#ffffff" opacity="0.3" rx="2"/>
        </svg>
      </div>

      <!-- Writing Interface -->
      <div id="writing-view" class="writing-container hidden">
        <p class="writing-prompt">What do you need to release?</p>
        <input 
          type="text" 
          id="msg" 
          class="message-input" 
          placeholder="Write it down..."
          maxlength="100"
        >
        <button id="throw-btn" class="throw-button" disabled>
          Throw It
        </button>
      </div>
    </div>
  </div>

  <script>
    // ═══════════════════════════════════════════════════════════════
    // APP STATE
    // ═══════════════════════════════════════════════════════════════
    
    let throwCount = 0;
    let selectedObject = null;
    let debris = [];
    let impactMarks = [];
    let activeParticles = [];

    // ═══════════════════════════════════════════════════════════════
    // AUDIO ENGINE - Web Audio API
    // ═══════════════════════════════════════════════════════════════
    
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx = null;

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new AudioContext();
      }
    }

    function playBreakSound(material) {
      initAudio();
      
      const now = audioCtx.currentTime;
      
      if (material === 'glass') {
        // Glass: bright, crystalline shattering
        for (let i = 0; i < 8; i++) {
          const osc = audioCtx.createOscillator();
          const gain = audioCtx.createGain();
          
          osc.frequency.setValueAtTime(800 + Math.random() * 2000, now);
          osc.frequency.exponentialRampToValueAtTime(100, now + 0.5);
          
          gain.gain.setValueAtTime(0.15, now);
          gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
          
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          
          osc.start(now + i * 0.02);
          osc.stop(now + 0.5);
        }
        
        // Glass shimmer
        const noise = audioCtx.createBufferSource();
        const noiseBuffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.3, audioCtx.sampleRate);
        const output = noiseBuffer.getChannelData(0);
        for (let i = 0; i < output.length; i++) {
          output[i] = Math.random() * 2 - 1;
        }
        noise.buffer = noiseBuffer;
        
        const noiseFilter = audioCtx.createBiquadFilter();
        noiseFilter.type = 'highpass';
        noiseFilter.frequency.setValueAtTime(2000, now);
        
        const noiseGain = audioCtx.createGain();
        noiseGain.gain.setValueAtTime(0.08, now);
        noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
        
        noise.connect(noiseFilter);
        noiseFilter.connect(noiseGain);
        noiseGain.connect(audioCtx.destination);
        
        noise.start(now);
        noise.stop(now + 0.3);
        
      } else if (material === 'ceramic') {
        // Ceramic: duller, more brittle crack
        for (let i = 0; i < 6; i++) {
          const osc = audioCtx.createOscillator();
          const gain = audioCtx.createGain();
          
          osc.frequency.setValueAtTime(300 + Math.random() * 800, now);
          osc.frequency.exponentialRampToValueAtTime(80, now + 0.4);
          
          gain.gain.setValueAtTime(0.2, now);
          gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
          
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          
          osc.start(now + i * 0.03);
          osc.stop(now + 0.4);
        }
        
        // Ceramic crunch
        const noise = audioCtx.createBufferSource();
        const noiseBuffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.25, audioCtx.sampleRate);
        const output = noiseBuffer.getChannelData(0);
        for (let i = 0; i < output.length; i++) {
          output[i] = Math.random() * 2 - 1;
        }
        noise.buffer = noiseBuffer;
        
        const noiseFilter = audioCtx.createBiquadFilter();
        noiseFilter.type = 'bandpass';
        noiseFilter.frequency.setValueAtTime(600, now);
        noiseFilter.Q.setValueAtTime(2, now);
        
        const noiseGain = audioCtx.createGain();
        noiseGain.gain.setValueAtTime(0.15, now);
        noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
        
        noise.connect(noiseFilter);
        noiseFilter.connect(noiseGain);
        noiseGain.connect(audioCtx.destination);
        
        noise.start(now);
        noise.stop(now + 0.25);
      }
      
      // Impact thud (for both)
      const thudOsc = audioCtx.createOscillator();
      const thudGain = audioCtx.createGain();
      
      thudOsc.frequency.setValueAtTime(80, now);
      thudOsc.frequency.exponentialRampToValueAtTime(20, now + 0.15);
      
      thudGain.gain.setValueAtTime(0.3, now);
      thudGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
      
      thudOsc.connect(thudGain);
      thudGain.connect(audioCtx.destination);
      
      thudOsc.start(now);
      thudOsc.stop(now + 0.15);
    }

    // ═══════════════════════════════════════════════════════════════
    // APP INITIALIZATION
    // ═══════════════════════════════════════════════════════════════
    
    function enterApp() {
      const landing = document.getElementById('landing-screen');
      const mainApp = document.getElementById('main-app');
      
      landing.classList.add('fade-out');
      
      setTimeout(() => {
        landing.classList.add('hidden');
        mainApp.classList.remove('hidden');
        mainApp.classList.add('fade-in');
        
        // Initialize audio on user interaction
        initAudio();
      }, 600);
    }

    // ═══════════════════════════════════════════════════════════════
    // OBJECT SELECTION
    // ═══════════════════════════════════════════════════════════════
    
    document.addEventListener('DOMContentLoaded', () => {
      const objects = document.querySelectorAll('.object-item');
      const itemsView = document.getElementById('items-view');
      const writingView = document.getElementById('writing-view');
      const messageInput = document.getElementById('msg');
      const throwBtn = document.getElementById('throw-btn');
      
      objects.forEach(obj => {
        obj.addEventListener('click', () => {
          selectedObject = {
            type: obj.dataset.type,
            material: obj.dataset.material
          };
          
          // Highlight selected
          objects.forEach(o => o.classList.remove('selected'));
          obj.classList.add('selected');
          
          // Show writing interface
          setTimeout(() => {
            itemsView.classList.add('fade-out');
            setTimeout(() => {
              itemsView.classList.add('hidden');
              writingView.classList.remove('hidden');
              writingView.classList.add('fade-in');
              messageInput.focus();
            }, 300);
          }, 200);
        });
      });

      // Enable throw button when message is entered
      messageInput.addEventListener('input', (e) => {
        throwBtn.disabled = e.target.value.trim().length === 0;
      });

      // Handle throw
      throwBtn.addEventListener('click', handleThrow);
      messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !throwBtn.disabled) {
          handleThrow();
        }
      });
    });

    // ═══════════════════════════════════════════════════════════════
    // THROW MECHANICS
    // ═══════════════════════════════════════════════════════════════
    
    function handleThrow() {
      if (!selectedObject) return;
      
      const throwBtn = document.getElementById('throw-btn');
      const messageInput = document.getElementById('msg');
      
      // Disable button during throw
      throwBtn.disabled = true;
      throwBtn.textContent = 'Releasing...';
      
      // Calculate impact point (center-ish of wall)
      const impactX = window.innerWidth / 2 + (Math.random() - 0.5) * 200;
      const impactY = window.innerHeight * 0.35 + (Math.random() - 0.5) * 100;
      
      // Visual and audio effects
      setTimeout(() => {
        createParticles(impactX, impactY, selectedObject.material);
        playBreakSound(selectedObject.material);
        
        // Update counter
        throwCount++;
        document.getElementById('throw-count').textContent = throwCount;
      }, 300);
      
      // Reset after throw
      setTimeout(() => {
        messageInput.value = '';
        throwBtn.textContent = 'Throw It';
        
        // Return to object selection
        const itemsView = document.getElementById('items-view');
        const writingView = document.getElementById('writing-view');
        
        writingView.classList.add('fade-out');
        setTimeout(() => {
          writingView.classList.add('hidden');
          itemsView.classList.remove('hidden');
          itemsView.classList.add('fade-in');
          
          // Clear selection
          document.querySelectorAll('.object-item').forEach(o => o.classList.remove('selected'));
          selectedObject = null;
        }, 300);
      }, 1500);
    }

    // ═══════════════════════════════════════════════════════════════
    // PARTICLE SYSTEM
    // ═══════════════════════════════════════════════════════════════
    
    function createParticles(x, y, material) {
      const specs = {
        glass: { 
          count: 100, 
          speed: [200, 700], 
          sizes: [3, 18],
          colors: [
            'rgba(0, 212, 255, 0.9)',  // StrayStation cyan
            'rgba(0, 153, 255, 0.8)',  // StrayStation blue
            'rgba(180, 230, 255, 0.7)'
          ],
          glow: 'rgba(0, 212, 255, 0.6)',
          debrisCount: 20
        },
        ceramic: { 
          count: 85, 
          speed: [180, 650],
          sizes: [4, 16],
          colors: [
            'rgba(232, 216, 196, 0.95)', 
            'rgba(192, 176, 148, 0.9)', 
            'rgba(210, 195, 175, 0.92)'
          ],
          glow: null,
          debrisCount: 18
        }
      };
      
      const spec = specs[material];
      
      // Main explosion particles
      for (let i = 0; i < spec.count; i++) {
        const angle = (Math.PI * 2 * i / spec.count) + (Math.random() - 0.5) * 0.8;
        const speed = spec.speed[0] + Math.random() * (spec.speed[1] - spec.speed[0]);
        const size = spec.sizes[0] + Math.random() * (spec.sizes[1] - spec.sizes[0]);
        
        const p = document.createElement('div');
        p.className = 'particle-pro';
        p.style.left = x + 'px';
        p.style.top = y + 'px';
        p.style.width = size + 'px';
        p.style.height = size + 'px';
        
        const color = spec.colors[Math.floor(Math.random() * spec.colors.length)];
        p.style.background = color;
        
        if (spec.glow) {
          p.style.boxShadow = `0 0 ${size * 2}px ${spec.glow}, inset 0 0 ${size}px rgba(255,255,255,0.3)`;
        } else {
          p.style.boxShadow = `0 2px ${size}px rgba(0,0,0,0.5), inset -${size/2}px -${size/2}px ${size}px rgba(0,0,0,0.3)`;
        }
        
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed - (Math.random() * 100);
        const rotation = Math.random() * 1800 - 900;
        
        p.style.setProperty('--vx', vx + 'px');
        p.style.setProperty('--vy', vy + 'px');
        p.style.setProperty('--rotation', rotation + 'deg');
        
        document.body.appendChild(p);
        activeParticles.push({ el: p, created: Date.now() });
        
        setTimeout(() => {
          p.remove();
          activeParticles = activeParticles.filter(ap => ap.el !== p);
        }, 2000);
      }
      
      // Persistent debris on ground
      for (let i = 0; i < spec.debrisCount; i++) {
        const angle = Math.random() * Math.PI * 2;
        const distance = 80 + Math.random() * 300;
        const debrisX = x + Math.cos(angle) * distance;
        const debrisY = y + Math.sin(angle) * distance * 0.4 + (window.innerHeight * 0.35);
        
        const d = document.createElement('div');
        d.className = 'debris-piece';
        d.style.left = debrisX + 'px';
        d.style.top = debrisY + 'px';
        
        const debrisSize = spec.sizes[0] + Math.random() * (spec.sizes[1] - spec.sizes[0]) * 0.8;
        d.style.width = debrisSize + 'px';
        d.style.height = debrisSize + 'px';
        d.style.transform = `rotate(${Math.random() * 360}deg)`;
        
        const color = spec.colors[Math.floor(Math.random() * spec.colors.length)];
        d.style.background = color;
        d.style.opacity = '0.85';
        
        if (spec.glow) {
          d.style.boxShadow = `0 2px 4px rgba(0,0,0,0.3), 0 0 ${debrisSize}px ${spec.glow}`;
        } else {
          d.style.boxShadow = `0 2px 6px rgba(0,0,0,0.4)`;
        }
        
        document.body.appendChild(d);
        debris.push(d);
        
        // Auto-cleanup
        setTimeout(() => {
          d.style.transition = 'opacity 1s ease-out';
          d.style.opacity = '0';
        }, 3000);
        setTimeout(() => {
          d.remove();
          debris = debris.filter(item => item !== d);
        }, 4000);
      }
      
      // Impact mark
      const impact = document.createElement('div');
      impact.className = 'impact-mark';
      impact.style.left = (x - 60) + 'px';
      impact.style.top = (y - 60) + 'px';
      impact.style.width = '120px';
      impact.style.height = '120px';
      
      if (material === 'glass') {
        impact.style.background = 'radial-gradient(circle, rgba(0, 212, 255, 0.4) 0%, rgba(0, 153, 255, 0.2) 40%, transparent 70%)';
        impact.style.boxShadow = '0 0 40px rgba(0, 212, 255, 0.5), inset 0 0 30px rgba(0, 212, 255, 0.3)';
      } else {
        impact.style.background = 'radial-gradient(circle, rgba(80, 70, 60, 0.45) 0%, rgba(60, 50, 40, 0.25) 45%, transparent 70%)';
        impact.style.boxShadow = '0 0 25px rgba(0, 0, 0, 0.4)';
      }
      
      document.body.appendChild(impact);
      impactMarks.push(impact);
      
      setTimeout(() => {
        impact.style.transition = 'opacity 1s ease-out';
        impact.style.opacity = '0';
      }, 3000);
      setTimeout(() => {
        impact.remove();
        impactMarks = impactMarks.filter(item => item !== impact);
      }, 4000);
      
      // Dust cloud
      createDustCloud(x, y, material);
    }
    
    function createDustCloud(x, y, material) {
      const dustCount = 25;
      const dustColors = {
        glass: 'rgba(0, 212, 255, 0.3)',
        ceramic: 'rgba(210, 190, 170, 0.4)'
      };
      
      for (let i = 0; i < dustCount; i++) {
        const dust = document.createElement('div');
        dust.className = 'dust-particle';
        
        const angle = Math.random() * Math.PI * 2;
        const distance = Math.random() * 120;
        const dustX = x + Math.cos(angle) * distance;
        const dustY = y + Math.sin(angle) * distance;
        
        dust.style.left = dustX + 'px';
        dust.style.top = dustY + 'px';
        
        const size = 6 + Math.random() * 18;
        dust.style.width = size + 'px';
        dust.style.height = size + 'px';
        dust.style.background = dustColors[material];
        dust.style.borderRadius = '50%';
        dust.style.filter = 'blur(' + (2 + Math.random() * 3) + 'px)';
        
        document.body.appendChild(dust);
        setTimeout(() => dust.remove(), 2000);
      }
    }
  </script>
</body>
</html>
